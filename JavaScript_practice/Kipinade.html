<!DOCTYPE html>
<html>
<head><title>Kipinade</title>
<meta charset="utf-8"/>
<style>
@media (min-width: 280px) {body {font-size: 12px;} }
@media (min-width: 320px) {body {font-size: 14px;} }
@media (min-width: 423px) {body {font-size: 15px;} }
@media (min-width: 526px) {body {font-size: 17px;} }
@media (min-width: 768px) {body {font-size: 22px;} }
@media (min-width: 992px) {body {font-size: 25px;} }
@media (min-width: 1200px) {body {font-size: 29px;} }

body{
    background-color: #134;
	color: #fff;
	font-family: arial, verdana, "sans-serif";
}
.top-heading{
    font-size: 2.0em;
	text-align: center;
}
.k-btn{
    background-color: #afa;
    color: #000;
    width: 7em;
    height: 2em;
    border: none;
    border-radius: 15px;
    font-size: 0.8em;
    
}
.squares-grid{
     display: block;
	 float: left;
	 margin: 1.5em;
     background-color: #aaa;
     padding: 0.2em;
     border: 0.5em solid #134;
}

.square{
    height: 1.7em;
    width: 1.7em;
    border: 0.26em solid #aaa;
    display: inline-block;
	text-align: center;
	color: #fff;
	line-height: 1.7;
	font-weight: bold;
    font-size: 1em;
}
.options-grid{
    display: block;
	float: left;
	margin: 1.5em;
}
.option{
    height: 1.3em;
    width: 1.3em;
    border: 0.1em solid #998;
    display: inline-block;
	text-align: center;
}
.notify{
   background-color: #faa;
   color: #000;
   display: inline-block;
   margin: 1.5em;
   display: none;
   width: 8em;
   border-radius: 5%;
}
.x{
   float: right;
   display: inline-block;
   margin-right: 0.3em;
   font-size: 1.5em;
}
.note{
    padding: 1em;
}
</style>

</head>
<body>

<div class="main-div">
    <div class="top-heading">Kipinade</div>
    <div class="button-box">
       <button type="button" class="k-btn" id="swap" onclick="handleSwapBtn()">Swap Mode</button>
    </div>
    <div class="squares-grid" id="squares-grid">
        <div class="squares-row">
			 <div class="square" id='s00' onClick="modeDetect(0,0)"> </div>
            <div class="square" id='s01' onClick="modeDetect(0,1)"> </div>
            <div class="square" id='s02' onClick="modeDetect(0,2)"> </div>
            <div class="square" id='s03' onClick="modeDetect(0,3)"> </div>
            <div class="square" id='s04' onClick="modeDetect(0,4)"> </div>
            <div class="square" id='s05' onClick="modeDetect(0,5)"> </div>
            <div style="clear:both"></div>
        </div>
        <div class="squares-row">
            <div class="square" id='s10' onClick="modeDetect(1,0)"> </div>
            <div class="square" id='s11' onClick="modeDetect(1,1)"> </div>
            <div class="square" id='s12' onClick="modeDetect(1,2)"> </div>
            <div class="square" id='s13' onClick="modeDetect(1,3)"> </div>
            <div class="square" id='s14' onClick="modeDetect(1,4)"> </div>
            <div class="square" id='s15' onClick="modeDetect(1,5)"> </div>
            <div style="clear:both"></div>
        </div>
        <div class="squares-row">
            <div class="square" id='s20' onClick="modeDetect(2,0)"> </div>
            <div class="square" id='s21' onClick="modeDetect(2,1)"> </div>
            <div class="square" id='s22' onClick="modeDetect(2,2)"> </div>
            <div class="square" id='s23' onClick="modeDetect(2,3)"> </div>
            <div class="square" id='s24' onClick="modeDetect(2,4)"> </div>
            <div class="square" id='s25' onClick="modeDetect(2,5)"> </div>
            <div style="clear:both"></div>
        </div>
        <div class="squares-row">
            <div class="square" id='s30' onClick="modeDetect(3,0)"> </div>
            <div class="square" id='s31' onClick="modeDetect(3,1)"> </div>
            <div class="square" id='s32' onClick="modeDetect(3,2)"> </div>
            <div class="square" id='s33' onClick="modeDetect(3,3)"> </div>
            <div class="square" id='s34' onClick="modeDetect(3,4)"> </div>
            <div class="square" id='s35' onClick="modeDetect(3,5)"> </div>
            <div style="clear:both"></div>
        </div>
        <div class="squares-row">
            <div class="square" id='s40' onClick="modeDetect(4,0)"> </div>
            <div class="square" id='s41' onClick="modeDetect(4,1)"> </div>
            <div class="square" id='s42' onClick="modeDetect(4,2)"> </div>
            <div class="square" id='s43' onClick="modeDetect(4,3)"> </div>
            <div class="square" id='s44' onClick="modeDetect(4,4)"> </div>
            <div class="square" id='s45' onClick="modeDetect(4,5)"> </div>
            <div style="clear:both"></div>
        </div>
        <div class="squares-row">
            <div class="square" id='s50' onClick="modeDetect(5,0)"> </div>
            <div class="square" id='s51' onClick="modeDetect(5,1)"> </div>
            <div class="square" id='s52' onClick="modeDetect(5,2)"> </div>
            <div class="square" id='s53' onClick="modeDetect(5,3)"> </div>
            <div class="square" id='s54' onClick="modeDetect(5,4)"> </div>
            <div class="square" id='s55' onClick="modeDetect(5,5)"> </div>
            <div style="clear:both"></div>
        </div>
    </div>

    </div>
	<div class="notify" id="notify">
        <div class="x">&times;</div>	
	    <div style="clear:both"></div>
	    <div class="note" id="note">test</div>
	</div>
    <div style="clear:both"></div>
    <div class="score-box">
        <div class="score-heading">Score:</div>
        <div class="score" id="score"></div>
    </div>
</div>
<script type="text/javascript">

var posValues = [];

function Square(number,colour){
   this.number = 0;
   this.colour = '#000000';
}

let col = '#000000';

const posIds = [ ['s00', 's01', 's02', 's03', 's04', 's05'],
                 ['s10', 's11', 's12', 's13', 's14', 's15'],
                 ['s20', 's21', 's22', 's23', 's24', 's25'],
                 ['s30', 's31', 's32', 's33', 's34', 's35'],
                 ['s40', 's41', 's42', 's43', 's44', 's45'],
                 ['s50', 's51', 's52', 's53', 's54', 's55']  ]
var posX;
var posY;
var xPrev;
var yPrev;
var diffX = 0;
var diffY = 0;

var firstPairSet = 0;

var a = -1;
var b = -1;

var initialSwaps = 0;
const INITIAL_SWAP_LIMIT = 5;
const CURRENT_COLOUR_MARKER = "#333333";

posX = Math.floor(Math.random() * 4 + 1);
posY = Math.floor(Math.random() * 4 + 1);
xPrev = posX;
yPrev = posY;

swapOn = false;

document.getElementById(posIds[posX][posY]).style.borderColor = CURRENT_COLOUR_MARKER;

var points = 0;

var notice = document.getElementById("notify");

var xClose = document.getElementsByClassName("x")[0];

for(let i=0; i<6; i++){
	posValues[i] = [];
    for(let j=0; j<6; j++){
       //alert(i,j);
       let num = Math.floor(Math.random() * 5 + 1);
       let colN = Math.floor(Math.random() * 5 + 1);
       switch(colN){
          case 1:
              col = "#0011dd";
              break;
          case 2:
              col = "#dd9900";
              break;
          case 3:
              col = "#228822";
              break;
          case 4:
              col = "#cc0022";
              break;
          case 5:
              col = "#663377";
              break;
          default: alert("none matched in switch");
       }
       posValues[i][j] = new Square();
       posValues[i][j].number = num;
       posValues[i][j].colour = col;

       document.getElementById(posIds[i][j]).innerHTML = posValues[i][j].number;
       document.getElementById(posIds[i][j]).style.backgroundColor = posValues[i][j].colour;
    }
}

function handleSwapBtn(){
       if(swapOn){
          document.getElementById('swap').style.backgroundColor = "#afa";
          document.getElementById('squares-grid').style.borderColor = "#134";
          swapOn = false;
         // alert("Swap Mode now off");
       }
       else{
          document.getElementById('swap').style.backgroundColor = "#8ff";
          document.getElementById('squares-grid').style.borderColor = "#8ff";
          swapOn = true;
          //alert("Swap Mode now on");
       }
}

function modeDetect(x,y){
       if(swapOn){
          swap(x,y);
       }
       else{
          move(x,y);
       }
       
}

function move(x,y){  
    diffX = x-xPrev;
	diffY = y-yPrev;
	if (diffX > -2 && diffX < 2 && diffY > -2 && diffY < 2){
             if( posValues[x][y].number == posValues[xPrev][yPrev].number || posValues[x][y].colour === posValues[xPrev][yPrev].colour ){
		        document.getElementById(posIds[x][y]).style.borderColor = CURRENT_COLOUR_MARKER;
		        document.getElementById(posIds[xPrev][yPrev]).style.borderColor = "#aaa";
		        posValues[xPrev][yPrev].number = Math.floor(Math.random() * 5 + 1);
                let colN = Math.floor(Math.random() * 5 + 1);
                switch(colN){
                  case 1:
                    col = "#0011dd";
                    break;
                  case 2:
                    col = "#dd9900";
                    break;
                  case 3:
                    col = "#228822";
                   break;
                  case 4:
                    col = "#cc0022";
                    break;
                  case 5:
                    col = "#663377";
                    break;
                  default: alert("none matched in switch");
                }
                posValues[xPrev][yPrev].colour = col;
		        document.getElementById(posIds[xPrev][yPrev]).innerHTML = posValues[xPrev][yPrev].number;
                document.getElementById(posIds[xPrev][yPrev]).style.backgroundColor = posValues[xPrev][yPrev].colour;
		        xPrev = x;
		        yPrev = y;
                points++;
                document.getElementById('score').innerHTML = points;
              }
              else{
                 // alert("You may only move to a square that has the same number or the same colour as the one you are on.");
				  alert(posValues[x][y].number);
				  alert("prev=" + posValues[xPrev][yPrev].number);
				  notifyUser("You may only move to a square that has the same number or the same colour as the one you are on.");
				  
              }
	}
	else{
	  //  alert("You may not move more than one square at a time. Please try again.");
		notifyUser("You may not move more than one square at a time. Please try again.");
	}
}

function swap(x,y){
      if(initialSwaps < INITIAL_SWAP_LIMIT){
			if (firstPairSet){
			   document.getElementById(posIds[a][b]).style.opacity = "1";
			   let shelfNumber = posValues[x][y].number; 
			   posValues[x][y].number = posValues[a][b].number;
			   posValues[a][b].number = shelfNumber;
			   document.getElementById(posIds[a][b]).innerHTML = posValues[a][b].number;
			   document.getElementById(posIds[x][y]).innerHTML = posValues[x][y].number;
			   let shelfColour = posValues[x][y].colour; 
			   posValues[x][y].colour = posValues[a][b].colour;
			   posValues[a][b].colour = shelfColour;
			   document.getElementById(posIds[a][b]).style.backgroundColor = posValues[a][b].colour;
			   document.getElementById(posIds[x][y]).style.backgroundColor = posValues[x][y].colour;
			   firstPairSet = 0;
			   initialSwaps++;
			  // alert("Number of swaps made:" + initialSwaps);
			   handleSwapBtn();
			}
			else{
			   a = x;
			   b = y;
			   document.getElementById(posIds[a][b]).style.opacity = "0.3";
			   firstPairSet = 1;			    
			}	     			
	  }
	  else{	       
			notifyUser("Sorry, you may not make another swap at this time, your initial 5 free swaps have all been used.");
	  }
}

function notifyUser(msg) { 
   document.getElementById('note').innerHTML = msg;
   notice.style.display = "inline-block";
}

xClose.onclick = function() {
  notice.style.display = "none";
}

</script>

</body>
</html>

