<!DOCTYPE html>
<html>
<head><title>Kipinade</title>
<meta charset="utf-8"/>
<style>
@media (min-width: 280px) {body {font-size: 12px;} }
@media (min-width: 320px) {body {font-size: 14px;} }
@media (min-width: 423px) {body {font-size: 16px;} }
@media (min-width: 526px) {body {font-size: 21px;} }
@media (min-width: 768px) {body {font-size: 21px;} }
@media (min-width: 992px) {body {font-size: 21px;} }

body{
    background-color: #134;
	color: #fff;
	font-family: arial, verdana, "sans-serif";
	text-align: center;
}
.top-heading{
    font-size: 2.0em;
}
.play-area{
   margin-top: 1.5em;
   width: 17.5em;
   display: inline-block;
}

.squares-grid{
	 width: 14.8em;
     background-color: #888;
     padding: 0.2em;
     border: 0.5em solid #134;
}

.square{
    height: 1.7em;
    width: 1.7em;
    border: 0.26em solid #888;
    display: inline-block;
	text-align: center;
	color: #fff;
	line-height: 1.7;
	font-weight: bold;
    font-size: 1em;
}

.controls-info{
    margin-top: 2em;
	width: 22em;
	vertical-align: top;
	text-align: left;
	display: inline-block;
}
.swap-btn{
    background-color: #afa;
    color: #000;
    width: 7em;
    height: 2em;
    border: none;
    border-radius: 15px;
    font-size: 0.8em;
}
.info-box{
}
.stats-box{
   float: left;
   display: inline-block;
}
.stats-grid{
    margin-top: 1.5em;
   display: grid;
   width: 12em;  
   grid-template-columns: 6em 1.5em;
   grid-template-rows: 1em 1em 1em 1em 1em;
   grid-gap: 0.5em;
   margin-bottom: 1.5em;
}
.stats-heading{
  font-size: 0.8em;
}
.stats{
  font-size: 0.8em;
  text-align: right;
}
.notify{
   background-color: #d97;
   color: #000;
   display: none;
   width: 10em;
   border-radius: 5%;
  /* display: inline-block;*/
}
.x{
   width: 98%;
   text-align: right;
   display: inline-block;
   font-size: 1.5em;
}
.note{
    padding: 0em;
	font-size: 0.9em;
	padding: 0 0.7em 0.7em 0.7em;
}
</style>

</head>
<body>

<div class="main-div">
    <div class="top-heading">Kipinade</div>
	<div class="play-area">
			<div class="squares-grid" id="squares-grid">
				<div class="squares-row">
					 <div class="square" id='s00' onClick="modeDetect(0,0)"> </div>
					<div class="square" id='s01' onClick="modeDetect(0,1)"> </div>
					<div class="square" id='s02' onClick="modeDetect(0,2)"> </div>
					<div class="square" id='s03' onClick="modeDetect(0,3)"> </div>
					<div class="square" id='s04' onClick="modeDetect(0,4)"> </div>
					<div class="square" id='s05' onClick="modeDetect(0,5)"> </div>
					<div style="clear:both"></div>
				</div>
				<div class="squares-row">
					<div class="square" id='s10' onClick="modeDetect(1,0)"> </div>
					<div class="square" id='s11' onClick="modeDetect(1,1)"> </div>
					<div class="square" id='s12' onClick="modeDetect(1,2)"> </div>
					<div class="square" id='s13' onClick="modeDetect(1,3)"> </div>
					<div class="square" id='s14' onClick="modeDetect(1,4)"> </div>
					<div class="square" id='s15' onClick="modeDetect(1,5)"> </div>
					<div style="clear:both"></div>
				</div>
				<div class="squares-row">
					<div class="square" id='s20' onClick="modeDetect(2,0)"> </div>
					<div class="square" id='s21' onClick="modeDetect(2,1)"> </div>
					<div class="square" id='s22' onClick="modeDetect(2,2)"> </div>
					<div class="square" id='s23' onClick="modeDetect(2,3)"> </div>
					<div class="square" id='s24' onClick="modeDetect(2,4)"> </div>
					<div class="square" id='s25' onClick="modeDetect(2,5)"> </div>
					<div style="clear:both"></div>
				</div>
				<div class="squares-row">
					<div class="square" id='s30' onClick="modeDetect(3,0)"> </div>
					<div class="square" id='s31' onClick="modeDetect(3,1)"> </div>
					<div class="square" id='s32' onClick="modeDetect(3,2)"> </div>
					<div class="square" id='s33' onClick="modeDetect(3,3)"> </div>
					<div class="square" id='s34' onClick="modeDetect(3,4)"> </div>
					<div class="square" id='s35' onClick="modeDetect(3,5)"> </div>
					<div style="clear:both"></div>
				</div>
				<div class="squares-row">
					<div class="square" id='s40' onClick="modeDetect(4,0)"> </div>
					<div class="square" id='s41' onClick="modeDetect(4,1)"> </div>
					<div class="square" id='s42' onClick="modeDetect(4,2)"> </div>
					<div class="square" id='s43' onClick="modeDetect(4,3)"> </div>
					<div class="square" id='s44' onClick="modeDetect(4,4)"> </div>
					<div class="square" id='s45' onClick="modeDetect(4,5)"> </div>
					<div style="clear:both"></div>
				</div>
				<div class="squares-row">
					<div class="square" id='s50' onClick="modeDetect(5,0)"> </div>
					<div class="square" id='s51' onClick="modeDetect(5,1)"> </div>
					<div class="square" id='s52' onClick="modeDetect(5,2)"> </div>
					<div class="square" id='s53' onClick="modeDetect(5,3)"> </div>
					<div class="square" id='s54' onClick="modeDetect(5,4)"> </div>
					<div class="square" id='s55' onClick="modeDetect(5,5)"> </div>
					<div style="clear:both"></div>
				</div>
			</div>
	  </div>

   <div class="controls-info">
	       <div class="button-box">
			   <button type="button" class="swap-btn" id="swap" onclick="handleSwapBtn()">Swap Mode</button>
			</div> 
			<div class="info-box">				
					 <div class="stats-box">
					       <div class="stats-grid">
								<div class="stats-heading">Moves:</div>
								<div class="stats" id="move">0</div>
								<div class="stats-heading">Squares Visited:</div>
								<div class="stats" id="visited">0</div>
								<div class="stats-heading">Swaps Left:</div>
								<div class="stats" id="swaps">5</div>
								<div class="stats-heading">Score:</div>
								<div class="stats" id="score">0</div>
							</div>
					</div>
					
					<div class="notify" id="notify">
						<div class="x">&times;</div>	
						<div class="note" id="note"></div>
					</div> 
					<div style="clear:both"></div>
			</div>
	</div> 
</div>
<script type="text/javascript">

var posValues = [];

function Square(number,colour){
   this.number = 0;
   this.colour = '#000000';
}

let col = '#000000';

const posIds = [ ['s00', 's01', 's02', 's03', 's04', 's05'],
                 ['s10', 's11', 's12', 's13', 's14', 's15'],
                 ['s20', 's21', 's22', 's23', 's24', 's25'],
                 ['s30', 's31', 's32', 's33', 's34', 's35'],
                 ['s40', 's41', 's42', 's43', 's44', 's45'],
                 ['s50', 's51', 's52', 's53', 's54', 's55']  ]
var posX;
var posY;
var xPrev;
var yPrev;
var diffX = 0;
var diffY = 0;

var firstPairSet = 0;

var a = -1;
var b = -1;

var initialSwaps = 0;
const INITIAL_SWAP_LIMIT = 5;
const CURRENT_COLOUR_MARKER = "#eee";

posX = Math.floor(Math.random() * 4 + 1);
posY = Math.floor(Math.random() * 4 + 1);
xPrev = posX;
yPrev = posY;

swapOn = false;

document.getElementById(posIds[posX][posY]).style.borderColor = CURRENT_COLOUR_MARKER;

var moves = 0;
var squaresVisited = 0;

var notice = document.getElementById("notify");

var xClose = document.getElementsByClassName("x")[0];

var gameInProgress = true;

for(let i=0; i<6; i++){
	posValues[i] = [];
    for(let j=0; j<6; j++){
       //alert(i,j);
       let num = Math.floor(Math.random() * 5 + 1);
       let colN = Math.floor(Math.random() * 5 + 1);
       switch(colN){
          case 1:
              col = "#0011dd";
              break;
          case 2:
              col = "#dd9900";
              break;
          case 3:
              col = "#228822";
              break;
          case 4:
              col = "#cc0022";
              break;
          case 5:
              col = "#663377";
              break;
          default: alert("none matched in switch");
       }
       posValues[i][j] = new Square();
       posValues[i][j].number = num;
       posValues[i][j].colour = col;
	   posValues[i][j].visited = false;

       document.getElementById(posIds[i][j]).innerHTML = posValues[i][j].number;
       document.getElementById(posIds[i][j]).style.backgroundColor = posValues[i][j].colour;
    }
}

function handleSwapBtn(){
       if(swapOn){
          document.getElementById('swap').style.backgroundColor = "#afa";
          document.getElementById('squares-grid').style.borderColor = "#134";
          swapOn = false;
         // alert("Swap Mode now off");
       }
       else{
          document.getElementById('swap').style.backgroundColor = "#8ff";
          document.getElementById('squares-grid').style.borderColor = "#8ff";
          swapOn = true;
          //alert("Swap Mode now on");
       }
}

function modeDetect(x,y){
    xClose.onclick();
   if(gameInProgress){
       if(swapOn){
          swap(x,y);
       }
       else{
          move(x,y);
       }
   }  
}

function move(x,y){  
    diffX = x-xPrev;
	diffY = y-yPrev;
	if (diffX > -2 && diffX < 2 && diffY > -2 && diffY < 2){
             if( posValues[x][y].number == posValues[xPrev][yPrev].number || posValues[x][y].colour === posValues[xPrev][yPrev].colour ){
		        document.getElementById(posIds[x][y]).style.borderColor = CURRENT_COLOUR_MARKER;
				console.log(`X= ${x}   Y= ${y}`);
		        document.getElementById(posIds[xPrev][yPrev]).style.borderColor = "#888";
		        posValues[xPrev][yPrev].number = Math.floor(Math.random() * 5 + 1);
				
				if(posValues[x][y].visited == false){
				   document.getElementById(posIds[x][y]).style.color = "#000";
				   posValues[x][y].visited = true;
				   squaresVisited++
				   document.getElementById("visited").innerHTML = squaresVisited;
				   
				   if (squaresVisited > 35){
				      notifyUser("Game Over! You have won!!!");
                      calculateScore();
					  endGame();
					  
				   }
				}
				
                let colN = Math.floor(Math.random() * 5 + 1);
                switch(colN){
                  case 1:
                    col = "#0011dd";
                    break;
                  case 2:
                    col = "#dd9900";
                    break;
                  case 3:
                    col = "#228822";
                   break;
                  case 4:
                    col = "#cc0022";
                    break;
                  case 5:
                    col = "#663377";
                    break;
                  default: alert("none matched in switch");
                }
                posValues[xPrev][yPrev].colour = col;
		        document.getElementById(posIds[xPrev][yPrev]).innerHTML = posValues[xPrev][yPrev].number;
                document.getElementById(posIds[xPrev][yPrev]).style.backgroundColor = posValues[xPrev][yPrev].colour;
		        xPrev = x;
		        yPrev = y;
                moves++;
				
                document.getElementById('move').innerHTML = moves;
              }
              else{
				  notifyUser("You may only move to a square that has the same number or the same colour as the one you are on.");
				  
              }
	}
	else{
		notifyUser("You may not move more than one square at a time. Please try again.");
	}
}

function swap(x,y){
      if(initialSwaps < INITIAL_SWAP_LIMIT){
			if (firstPairSet){
			   document.getElementById(posIds[a][b]).style.opacity = "1";
			   let shelfNumber = posValues[x][y].number; 
			   posValues[x][y].number = posValues[a][b].number;
			   posValues[a][b].number = shelfNumber;
			   document.getElementById(posIds[a][b]).innerHTML = posValues[a][b].number;
			   document.getElementById(posIds[x][y]).innerHTML = posValues[x][y].number;
			   let shelfColour = posValues[x][y].colour; 
			   posValues[x][y].colour = posValues[a][b].colour;
			   posValues[a][b].colour = shelfColour;
			   document.getElementById(posIds[a][b]).style.backgroundColor = posValues[a][b].colour;
			   document.getElementById(posIds[x][y]).style.backgroundColor = posValues[x][y].colour;
			   firstPairSet = 0;
			   initialSwaps++;
			  // alert("Number of swaps made:" + initialSwaps);
			  document.getElementById("swaps").innerHTML = INITIAL_SWAP_LIMIT - initialSwaps;
			   handleSwapBtn();
			}
			else{
			   a = x;
			   b = y;
			   document.getElementById(posIds[a][b]).style.opacity = "0.3";
			   firstPairSet = 1;			    
			}	     			
	  }
	  else{	       
			notifyUser("Sorry, you may not make another swap at this time, your initial 5 free swaps have all been used.");
	  }
}
function calculateScore(){
     let base = 10000;
     let movesPenalty = moves * 75;
     let swapsLeftBonus = (INITIAL_SWAP_LIMIT - initialSwaps) * 150;
     let finalScore = base - movesPenalty + swapsLeftBonus;
     document.getElementById('score').innerHTML = finalScore;
}

function notifyUser(msg) { 
   document.getElementById('note').innerHTML = msg;
   notice.style.display = "inline-block";
}

xClose.onclick = function() {
  notice.style.display = "none";
}

function endGame(){
   gameInProgress = false;
}
</script>

</body>
</html>

